<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RAMSES Documentation: Embedded Compositing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ramses_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RAMSES Documentation
   &#160;<span id="projectnumber">25.0.1</span>
   </div>
   <div id="projectbrief">Information for RAMSES users and developers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Embedded Compositing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>From <a href="https://en.wikipedia.org/wiki/Compositing_window_manager">Wikipedia</a>:</p>
<blockquote class="doxtable">
<p>A compositing window manager is a window manager that provides applications with an off-screen buffer for each window. The window manager composites the window buffers into an image representing the screen and writes the result into the display memory. </p>
</blockquote>
<p><em>Embedded compositing</em> (or <em>nested compositing</em>) enables applications to nest (embed) other applications' surfaces in their own surface.</p>
<p>RAMSES provides an API for embedded compositing. Note that for embedded compositing to work the platform's system compositor has to support the wayland protocol.</p>
<p>The RAMSES renderer as a provider of the compositing service is called the <em>server</em>, while the other applications embedding their surfaces are called <em>clients</em>.</p>
<p>To establish a connection between the server and its client processes a UNIX domain socket (IPC) is used. There are two distinct ways to create and use such a socket on the RAMSES renderer to use the nested compositing functionality.</p>
<p>In the most common way the RAMSES renderer creates the socket file. This can be done by settig the file name in the renderer configuration. RAMSES will then on startup (if embedded compositing is available) create the unix domain socket. Client applications can connect to the socket created by the renderer using the socket name, the socket file descriptor or the dedicated environment variables as specified by wayland protocol: WAYLAND_DISPLAY or WAYLAND_SOCKET (for more info refer to official Wayland docs).</p>
<p>Letting RAMSES create the socket file implies that all the clients can be started only after the renderer has fully inititalized. The second way to create a unix domain socket to be used for connection between server and client is to create and bind the unix domain socket outside of RAMSES and only pass it's file descriptor to the renderer. This way, the renderer and all clients can be started separately and independently from each other. For more details, check <a class="el" href="classramses_1_1RendererConfig.html#a19cba6f38acdbe49c7be02896f59842b">ramses::RendererConfig::setWaylandEmbeddedCompositingSocketFD</a>.</p>
<h2>Configuration</h2>
<p>Configuration might happen via command line or via API.</p>
<p>By default none of these options are set. Thus creation and usage of display will not be possible.</p>
<p>Configuration of embedded compositor's socket is strict. You can set either the socket filename (incl. group name) or the socket file descriptor. These settings are exclusive to each other. If you provide both (file name and file descriptor) creation and usage of display will not be possible.</p>
<h4>Socket filename</h4>
<p>You can set the name of the socket file. The file will be created in the directory pointed to by <code>$XDG_RUNTIME_DIR</code></p>
<p>Command line </p><pre class="fragment">-wse filename
or
--wayland-socket-embedded filename
</pre><p>API in <code>RendererConfig</code> </p><pre class="fragment">status_t setWaylandEmbeddedCompositingSocketName(const char* socketname);
</pre><h4>Socket group ownership.</h4>
<p>It's possible to set the groupname for the socket file. If this option is set the group ownership of the socket file will be transered to this group.</p>
<p>Command line </p><pre class="fragment">-wsegn groupname
or
--wayland-socket-embedded-groupname groupname
</pre><p>API in <code>RendererConfig</code> : <a class="el" href="classramses_1_1RendererConfig.html#a9196a63eb52df10afdacc32f47d09323">ramses::RendererConfig::setWaylandEmbeddedCompositingSocketGroup</a></p>
<h4>Socket file descriptor</h4>
<p>Instead of the creating the socket file via RAMSES, you can provide the externally created socket file descriptor.</p>
<p>This works via API in <code>RendererConfig</code> : <a class="el" href="classramses_1_1RendererConfig.html#a19cba6f38acdbe49c7be02896f59842b">ramses::RendererConfig::setWaylandEmbeddedCompositingSocketFD</a></p>
<h2>Embedded Compositing API</h2>
<p>The only type available for RAMSES clients to facilitate embedded compositing is <a class="el" href="classramses_1_1StreamTexture.html">ramses::StreamTexture</a>. The notion behind the StreamTexture is that</p><ul>
<li>objects of this type can be used the same way and in the same places the normal Texture2D is used</li>
<li>only the platform (pre)defined surface IDs can be used as its source (see type <a class="el" href="namespaceramses.html#ac6d2218ebfe794dbe8d0f780f059de83">ramses::streamSource_t</a>)</li>
<li>if the surface is not available or the platform doesn't support embedded compositing the default fallback texture is used.</li>
</ul>
<p>To create the StreamTexture object one needs to call <a class="el" href="classramses_1_1Scene.html#a5b28c51e4b40355e305d1d5608da9303">ramses::Scene::createStreamTexture</a>(const Texture2D&amp; fallbackTexture, streamSource_t source, const char* name). The <code>source</code> is an ID of a surface which will be used for nested compositing. In case that surface is not available or the platform doesn't support embedded compositing the default texture (ie. <code>fallbackTexture</code>) will be used.</p>
<h2>Example</h2>
<p>The following code show the usage of the embedded compositing API in RAMSES. It creates a 2D quad which uses StreamTexture as its face.</p>
<p><a class="el" href="ramses-example-basic-compositing_2src_2main_8cpp-example.html">ramses-example-basic-compositing/src/main.cpp</a> </p><div class="fragment"><div class="line">    <span class="comment">// IMPORTANT NOTE: For simplicity and readability the example code does not check return values from API calls.</span></div><div class="line">    <span class="comment">//                 This should not be the case for real applications.</span></div><div class="line"></div><div class="line">    <span class="comment">// texture</span></div><div class="line">    <a class="code" href="classramses_1_1Texture2D.html">ramses::Texture2D</a>* texture =</div><div class="line">        <a class="code" href="classramses_1_1RamsesUtils.html#a4bad26f4d83f7bce22980669fd5bd216">ramses::RamsesUtils::CreateTextureResourceFromPng</a>(<span class="stringliteral">&quot;res/ramses-example-basic-compositing-texture.png&quot;</span>, <a class="code" href="namespaceramses.html">ramses</a>);</div><div class="line"></div><div class="line">    <span class="comment">// use Texture2D as fallback for StreamTexture</span></div><div class="line">    <a class="code" href="classramses_1_1StreamTexture.html">ramses::StreamTexture</a>* streamTexture = scene-&gt;createStreamTexture(*texture, static_cast&lt;ramses::streamSource_t&gt;(streamId), <span class="stringliteral">&quot;streamTexture&quot;</span>);</div><div class="line"></div></div><!-- fragment --></div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
