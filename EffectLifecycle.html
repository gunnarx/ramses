<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RAMSES Documentation: Effect lifecycle in RAMSES</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ramses_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RAMSES Documentation
   &#160;<span id="projectnumber">25.0.1</span>
   </div>
   <div id="projectbrief">Information for RAMSES users and developers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Effect lifecycle in RAMSES </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>General lifecycle</h1>
<p>Effects in RAMSES are immutable client resources, and as such follow the same lifecycle as any other client resources:</p><ul>
<li>they are created and destroyed by a <a class="el" href="classramses_1_1RamsesClient.html" title="Entry point of RAMSES client API. ">ramses::RamsesClient</a></li>
<li>they can be stored/loaded from files</li>
<li>the same effect can be used in multiple scenes</li>
<li>they are being sent asynchronously to subscribed ramses renderers</li>
</ul>
<p>The typical lifecycle of an effect resource is:</p><ul>
<li>load shader(s) from GLSL and create effect E by calling <a class="el" href="classramses_1_1RamsesClient.html#a2c594824fc18dd5a74fa42a3121eb831" title="Create a new Effect by parsing a GLSL shader described by an EffectDescription instance. Refer to RamsesClient::getLastEffectErrorMessages in case of parsing error. ">ramses::RamsesClient::createEffect()</a></li>
<li>create a scene S, use effect E in scene S, publish scene S etc.</li>
<li>subscribe to scene S on a renderer (local or remote)</li>
<li>renderer sees that scene S uses effect E</li>
<li>if renderer has any other scene which already uses effect E, it will reuse it. Otherwise...</li>
<li>renderer calls <a class="el" href="classramses_1_1IBinaryShaderCache.html#a5a7f3039ec6fbc9f375408a126772320" title="Used by RamsesRenderer to ask the application if it provides binary data for the Effect with the give...">ramses::IBinaryShaderCache::hasBinaryShader()</a> for effect E</li>
<li>if result is 'true', renderer gets binary version of effect from <a class="el" href="classramses_1_1IBinaryShaderCache.html" title="An interface used to exchange Binary Shader Cache with the RamsesRenderer. The RamsesRenderer will no...">ramses::IBinaryShaderCache</a><ul>
<li>effect can be uploaded to GPU right away</li>
</ul>
</li>
<li>if result is 'false', renderer will request effect E from client who provided scene S<ul>
<li>renderer waits till effect is provided</li>
<li>effect is compiled from shader sources</li>
<li>renderer calls <a class="el" href="classramses_1_1IBinaryShaderCache.html#abdf1178cb47610dc95e0bc314e15fb32" title="Used by RamsesRenderer to provide the application with a binary shader data an effect with the given ...">ramses::IBinaryShaderCache::storeBinaryShader()</a> to give the newly compiled binary shader to the application cache so that it can be used in future sessions</li>
</ul>
</li>
</ul>
<h1>Effect IDs</h1>
<p>It is important to note that effects and binary shaders are two different objects, and their IDs, despite having relationship to each other, have different values. Client-side effects have resource type ID same as any other <a class="el" href="classramses_1_1Resource.html" title="The Resource is the base class of all resources, such as arrays and textures. ">ramses::Resource</a> - <a class="el" href="structramses_1_1resourceId__t.html" title="Resource identifier used to refer to a resource. ">ramses::resourceId_t</a>. The renderer, however, refers to the binary shaders for effects by their <a class="el" href="namespaceramses.html#a02b0ed7a56199abe6ea3a892b85a057e" title="Effect identifier used by the renderer to refer to an effect. ">ramses::effectId_t</a>. Both are 128bit numbers, but their values are inherently different for the same effect. Tools which deal with effects reflect this behavior and offer the option to provide both types by providing a special command-line argument (&ndash;out-effect-id-type).</p>
<p>The client-side resourceId can be used to identify effects on the client side (e.g. when loading from files) while the renderer-side resourceId can be used with <a class="el" href="classramses_1_1IBinaryShaderCache.html" title="An interface used to exchange Binary Shader Cache with the RamsesRenderer. The RamsesRenderer will no...">ramses::IBinaryShaderCache</a>, or when using the resource caching interface <a class="el" href="classramses_1_1IRendererResourceCache.html" title="An interface used to implement a caching mechanism for resources used on the RamsesRenderer. Important: Please note that the resource ids in this context do not match client resource ids. ">ramses::IRendererResourceCache</a> which follows similar principles.</p>
<h1>Why are effects slow to process</h1>
<p>One essential difference between Effects and other resources is that effects are considerably more expensive to create during runtime for two reasons:</p><ol type="1">
<li>Effects are being parsed by a GLSlang compiler in <a class="el" href="classramses_1_1RamsesClient.html#a2c594824fc18dd5a74fa42a3121eb831" title="Create a new Effect by parsing a GLSL shader described by an EffectDescription instance. Refer to RamsesClient::getLastEffectErrorMessages in case of parsing error. ">ramses::RamsesClient::createEffect()</a>. This step is necessary in order for RAMSES to figure out which data is required by the effect, such as uniforms, vertex attributes and textures</li>
<li>For each subscribed renderer, effects are being compiled for the concrete target device. This is necessary because RAMSES as a distributed system must make sure that the same effect can be used on different platforms. This would not be possible if RAMSES would store and distribute binary shaders instead of effects/GLSL code</li>
</ol>
<h1>How to skip GLSlang compilation on client side</h1>
<p>To skip the GLSlang compilation step in <a class="el" href="classramses_1_1RamsesClient.html#a2c594824fc18dd5a74fa42a3121eb831" title="Create a new Effect by parsing a GLSL shader described by an EffectDescription instance. Refer to RamsesClient::getLastEffectErrorMessages in case of parsing error. ">ramses::RamsesClient::createEffect()</a>, the client application can simply do this step in a preprocessing step for all known in advance effects and store the result in resource files. For convenience, ramses provides a tool for exactly this purpose. See (<a class="el" href="GLSLToEffectResource.html">Storing effects in resource files</a>) for more info how to use it.</p>
<h1>How to skip the OpenGL X.Y compilation step on the renderer</h1>
<p>To skip the compilation on the renderer side, it is enough to provide a binary shader when asked for it in <a class="el" href="classramses_1_1IBinaryShaderCache.html#a5a7f3039ec6fbc9f375408a126772320" title="Used by RamsesRenderer to ask the application if it provides binary data for the Effect with the give...">ramses::IBinaryShaderCache::hasBinaryShader()</a>. In order for this to work, the binary shader must match exactly the source code of the original effect. In particular, this means:</p><ul>
<li>identical source code</li>
<li>identical defines and declared GLSL version</li>
<li>identical extensions</li>
<li>identical uniforms/vertex attributes and other inputs</li>
</ul>
<p>In order to make this task easier and avoid errors in the generation of binary shaders, RAMSES provides specialized tooling to convert GLSL code to binary shaders (<a class="el" href="GLSLToBinaryShader.html">Storing GLSL as binary shaders</a>). RAMSES DOES NOT provide the specific offline shader compiler - this is something which is typically included in the development SDK of the target platform. RAMSES prepares the shaders only to the point where the generated source code can be passed to the offline shader compiler. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
